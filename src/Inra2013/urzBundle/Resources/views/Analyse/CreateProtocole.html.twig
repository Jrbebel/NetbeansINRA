{% extends "Inra2013urzBundle:Default:IndexChercheur.html.twig" %}
{% block title %}Create Analyse{% endblock %}
{%block body%}

{%if Status is defined%}
<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>
    <p>Le protocole numéro {{ Num }} à bien été enregistrer.</p>

</div>

{% else %} <div class="well">
    <form method="POST" action="{{form_enctype(form)}}">

        <h4>Création d'un protocole</h4></br>


     {{form_rest(form)}} 


        </br>
{#Pour le premier type de catégorie#}
        <div id="style1"></div>
        <select id="analyse1" class="select"><option>Sélectionner catégorie</option></select>
        </br>
        <div id="resultat1"></div>
{#Pour la deuxième type de catégorie#}
        <div id="style2"></div>
        <select id="analyse2" class="select"><option>Sélectionner catégorie</option></select>
        </br>
        <div id="resultat2"></div>

        </br>



        <input type="submit" value="Annuler" class="btn btn-danger" />
        <input type="submit" class="btn btn-primary" />






    </form> 
</div>


{%endif%}

{%endblock %}

 {% block stylesheets %}
<link rel="stylesheet" href="{{asset ('css/cupertino/jquery-ui-1.10.2.custom.min.css')}}" />  {# pour le theme de datepicker #} 
<link rel="stylesheet" type="text/css" href="{{asset('js/CLEditor1_3_0/jquery.cleditor.css')}}" /> {# pour le theme de cleditor #} 
{% endblock %}



{%block javascripts %}

<script type="text/javascript"  src="{{asset ('js/jquery-ui-1.10.0.custom.min.js')}}" ></script> {# pour le js de datepicker #}
<script type="text/javascript" src="{{asset('js/CLEditor1_3_0/jquery.cleditor.min.js')}}"></script> {# pour le js de cleditor #}
<script type="text/javascript" src="{{asset('js/CLEditor1_3_0/jquery.cleditor.js')}}"></script> {# pour le js de cleditor #}
<script type="text/javascript" src="{{asset('js/CLEditor1_3_0/plugin.js')}}"></script> {# pour le js de cleditor #}

<script type="text/javascript">
    $(document).ready(function() {        

        $(".ckeditor").cleditor();

    });
    </script>

    <script type="text/javascript">

        $('.date').datepicker({dateFormat: 'dd-mm-yy'})

        $(function() {

            $("#analyse1").hide();
            $("#analyse2").hide();

            $('input[type=checkbox]').click(function() {
                var cochee = $(this).is(':checked'); // je regarde si la case est cochée ou non 

                var value = $(this).attr("value"); //je recupere la valeur value dans le checkbox
                var DATA = 'id=' + value;

                var div_style_titre1 = "<fieldset><legend>Analyses Chimiques et Biochimiques</legend></fieldset>";
                var div_style_titre2 = "<fieldset><legend>Analyses Biologiques</legend></fieldset>";
                if (cochee == true) {
                    $(function() {

                        $.ajax({
                            url: "{{path('Inra2013Bundle_SearchCategorieAnalyse')}}", // j'utilise le lien pour aller cherche les contenus à rajouter
                            cache: false,
                            dataType: "json",
                            method: "POST",
                            data: DATA,
                            success: function(data) {

                                $.map(data, function(item, i) {



                                    if (value == 1) {  // si c le premier type de categorie
                                        $("#analyse1").show();
                                        var div_data = "<option value=" + item.id + ">" + item.Nom + "</option>";
                                        $(div_data).appendTo("#analyse1");
                                        if (i == 0) { // on affiche le titre qu'une seul fois 
                                            $(div_style_titre1).appendTo("#style1");
                                        }

                                    } else if (value == 2) {  //si c le deuxieme,on l'affiche dans une autre div 
                                        $("#analyse2").show();
                                        var div_data = "<option value=" + item.id + ">" + item.Nom + "</option>";
                                        $(div_data).appendTo("#analyse2");

                                        if (i == 0) {
                                            // on affiche le titre qu'une seul fois 
                                            $(div_style_titre2).appendTo("#style2");
                                        }
                                    }

                                })


                            }

                        })

                    });



                } else { //si on decoche le checkbox

                    if (value == 1) {

                        $("#style1").empty();
                        $("#analyse1").empty();
                        $("#analyse1").hide();

                    } else if (value == 2) {

                        $("#style2").empty()
                        $("#analyse2").empty();
                        $("#analyse2").hide();

                    }
                }


            });


            /***************************************************************************************************************************************/

            $("select#analyse1 ").click(function() {

                $("select#analyse1 option:selected").each(function() {

                    $("#resultat1").empty();
                    value = $(this).attr("value"); //je recupere la valeur value dans le selectionnée

                    var DATA = 'id=' + value;
                    $(function() {

                        $.ajax({
                            url: "{{path('Inra2013Bundle_SearchTypeAnalyse')}}", // j'utilise le lien pour aller cherche les contenus à rajouter
                            cache: false,
                            dataType: "json",
                            method: "POST",
                            data: DATA,
                            success: function(data) {

                                $.map(data, function(item, i) {


                                    var div_data = "<label class='checkbox  inline'><input type='checkbox' name='choix_analyse[]' id='inlineCheckbox'" + i + " value=" + item.id + ">" + item.Nom + "</label>";

                                    $(div_data).appendTo("#resultat1");



                                })


                            }

                        })

                    });



                });



            });

            $("select#analyse2 ").click(function() {


                $("select#analyse2 option:selected").each(function() {

                });



            });

        });


        </script>



{%endblock%}